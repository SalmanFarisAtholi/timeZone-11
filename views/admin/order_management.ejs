<%- include('../partials/admin_header.ejs') %>

<div class="container-fluid">
  <div class="row" style="display: flex; justify-content: center">
    <div class="col-lg-10">
      <table class="table table-striped">
        <thead>
          <tr>
            <th scope="col"></th>
            <th scope="col">METHOD</th>
            <th scope="col">TOTAL</th>
            <th scope="col">STATUS</th>
            <th style="width: 220px" scope="col">USER</th>
            <th scope="col"></th>
          </tr>
        </thead>
        <%ord.forEach(function(order,indux){ %>

        <tbody>
          <tr>
            <th scope="row"><%=indux+1%></th>
            <td><%=order.payment%></td>
            <td><%=order.total%></td>
            <% if(order.status=="Canceled"||order.status=="Delivered"){%>
            <td id="<%=order._id%>"><%=order.status%></td>
            <% }else{ %>
            <td id="<%=order._id%>sts">
              <select
                name="status"
                class="select"
                onchange="changeStatus(this,'<%=order._id%>')"
                id="<%=order._id%>"
              >
                <option value="<%=order.status%>"><%=order.status%></option>
                <option value="Shipped">Shipped</option>
                <option value="Canceled">Canceled</option>
                <option value="Out for Delivary">Out for Delivary</option>
                <option value="Delivered">Delivered</option>
              </select>
            </td>
            <% } %>
            <td><%=order.address%></td>
            <td>
              <a href="" class="btn_3">VIEW</a>
            </td>
          </tr>
        </tbody>
        <%}); %>
      </table>
    </div>
  </div>
</div>

<script>
  const changeStatus = function (newStatus, orderId) {
    let value = $("#" + orderId).val();
    fetch("/admin/updateStatus", {
      method: "post",
      headers: {
        "Content-type": "application/json",
      },
      body: JSON.stringify({ newStatus: newStatus.value, orderId: orderId }),
    })
      .then((data) => {
        return data.json();
      })
      .then((data) => {
        console.log("return data", data);
        if (newStatus.value == "Canceled" || newStatus.value == "Delivered") {
          $("#" + orderId + "sts").html(newStatus.value);
        }
      });
  };
</script>
